<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>core/test_suite.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Asserter.html">Asserter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#areEqual">areEqual</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#areIdentical">areIdentical</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#areNotEqual">areNotEqual</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#areNotIdentical">areNotIdentical</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isEmpty">isEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isFalse">isFalse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isMatching">isMatching</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isNotEmpty">isNotEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isNotNull">isNotNull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isNotUndefined">isNotUndefined</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isNull">isNull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isTrue">isTrue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#isUndefined">isUndefined</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#that">that</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Asserter.html#withDescription">withDescription</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Assertion.html">Assertion</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#doesNotInclude">doesNotInclude</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#doesNotRaise">doesNotRaise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#doesNotRaiseAnyErrors">doesNotRaiseAnyErrors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#includes">includes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#includesExactly">includesExactly</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isEmpty">isEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isEqualTo">isEqualTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isFalse">isFalse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isGreaterThan">isGreaterThan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isGreaterThanOrEqualTo">isGreaterThanOrEqualTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isIdenticalTo">isIdenticalTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isIncludedIn">isIncludedIn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isLessThan">isLessThan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isLessThanOrEqualTo">isLessThanOrEqualTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNearTo">isNearTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotEmpty">isNotEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotEqualTo">isNotEqualTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotIdenticalTo">isNotIdenticalTo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotIncludedIn">isNotIncludedIn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotNull">isNotNull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNotUndefined">isNotUndefined</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isNull">isNull</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isTrue">isTrue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#isUndefined">isUndefined</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#matches">matches</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Assertion.html#raises">raises</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Configuration.html">Configuration</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ConsoleUI.html">ConsoleUI</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DescribedAsserter.html">DescribedAsserter</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FailureGenerator.html">FailureGenerator</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FailureGenerator.html#with">with</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Formatter.html">Formatter</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PendingMarker.html">PendingMarker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PendingMarker.html#dueTo">dueTo</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Test.html">Test</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TestResult.html">TestResult</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TestRunner.html">TestRunner</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TestSuite.html">TestSuite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TestSuite.html#addTest">addTest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TestSuite.html#after">after</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TestSuite.html#before">before</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#after">after</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#assert">assert</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#before">before</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DIRECTORY_IDENTIFIERS">DIRECTORY_IDENTIFIERS</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#fail">fail</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#pending">pending</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#suite">suite</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#test">test</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">core/test_suite.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { isFunction, isStringWithContent, isUndefined, shuffle } from '../utils/index.js';
import { SuiteLocation } from '../location/suite_location.js';

/**
 * I represent a grouping of [tests]{@link Test} under a name, that will be executed by a
 * [runner]{@link TestRunner}. I can run some code [before]{@link TestSuite#before} and
 * [after]{@link TestSuite#after} each test.
 */
export class TestSuite {
  #name;
  #body;
  #tests;
  #currentTest;
  #callbacks;
  #before;
  #after;
  #isSkipped;
  #location;

  static BEFORE_HOOK_NAME = 'before';
  static AFTER_HOOK_NAME = 'after';

  // Error messages

  static invalidSuiteNameErrorMessage() {
    return 'Suite does not have a valid name. Please enter a non-empty string to name this suite.';
  }

  static invalidSuiteDefinitionBodyErrorMessage() {
    return 'Suite does not have a valid body. Please provide a function to declare the suite body.';
  }

  static alreadyDefinedHookErrorMessage(hookName) {
    return `There is already a ${hookName}() block. Please leave just one ${hookName}() block and run again the tests.`;
  }

  static hookWasNotInitializedWithAFunctionErrorMessage(hookName) {
    return `The ${hookName}() hook must include a function. Please provide a function or remove the ${hookName}() and run again the tests.`;
  }

  // Instance creation

  constructor(name, body, callbacks, pathLocation) {
    this.#initializeName(name);
    this.#initializeBody(body);
    this.#initializeLocation(pathLocation);
    this.#tests = [];
    this.#callbacks = callbacks;
    this.#before = undefined;
    this.#after = undefined;
    this.#isSkipped = false;
  }

  // Initializing / Configuring

  /**
   * Adds a new test to the suite.
   *
   * @param {!Test} test the test we'd like to add.
   * @returns {void}
   */
  addTest(test) {
    this.#tests.push(test);
  }

  /**
   * Registers a piece of code that should be executed before each test. There should be one `before` per suite, so it
   * will fail if there's already a `before` block in the suite.
   *
   * @param {!Function} initializationBlock the code you'd like to execute before each test.
   * @returns {void}
   */
  before(initializationBlock) {
    this.#validateHook(TestSuite.BEFORE_HOOK_NAME, initializationBlock, this.#before);

    this.#before = initializationBlock;
  }

  /**
   * Registers a piece of code that should be executed after each test. There should be one `after` per suite, so it
   * will fail if there's already an `after` block in the suite.
   *
   * @param {!Function} releasingBlock the code you'd like to execute after each test.
   * @returns {void}
   */
  after(releasingBlock) {
    this.#validateHook(TestSuite.AFTER_HOOK_NAME, releasingBlock, this.#after);

    this.#after = releasingBlock;
  }

  // Skipping
  skip() {
    this.#isSkipped = true;
  }

  isSkipped() {
    return this.#isSkipped;
  }

  #skipAllTests() {
    this.tests().forEach(test => {
      test.skip();
      test.finishWithSkippedStatus();
    });
  }

  // Executing

  async run(context) {
    this.#callbacks.onStart(this);
    this.#evaluateSuiteDefinition();
    if (this.isSkipped()) {
      this.#skipAllTests();
    } else {
      await this.#runTests(context);
    }
    this.#callbacks.onFinish(this);
  }

  // Counting

  totalCount() {
    return this.tests().length;
  }

  successCount() {
    return this.tests().filter(test => test.isSuccess()).length;
  }

  pendingCount() {
    return this.tests().filter(test => test.isPending()).length;
  }

  errorsCount() {
    return this.tests().filter(test => test.isError()).length;
  }

  skippedCount() {
    return this.tests().filter(test => test.isSkipped() || test.isExplicitlySkipped()).length;
  }

  failuresCount() {
    return this.totalCount() - this.successCount() - this.pendingCount() - this.errorsCount() - this.skippedCount();
  }

  // Accessing

  name() {
    return this.#name;
  }

  locationPath() {
    return this.#location.getPath();
  }

  currentTest() {
    return this.#currentTest;
  }

  tests() {
    return this.#tests;
  }

  allFailuresAndErrors() {
    return this.tests().filter(test => test.isFailure() || test.isError());
  }

  // Private - Validations

  #initializeBody(body) {
    this.#ensureBodyIsValid(body);
    this.#body = body;
  }

  #initializeName(name) {
    this.#ensureNameIsValid(name);
    this.#name = name;
  }

  #initializeLocation(pathLocation) {
    this.#location = new SuiteLocation(pathLocation);
  }

  #ensureNameIsValid(name) {
    if (!isStringWithContent(name)) {
      throw new Error(TestSuite.invalidSuiteNameErrorMessage());
    }
  }

  #ensureBodyIsValid(body) {
    if (!isFunction(body)) {
      throw new Error(TestSuite.invalidSuiteDefinitionBodyErrorMessage());
    }
  }

  #validateHook(hookName, hookToSet, existingHook) {
    this.#validateTheHookIsNotAlreadyDeclared(existingHook, hookName);
    this.#validateTheHookBlockIsAFunction(hookToSet, hookName);
  }

  #validateTheHookIsNotAlreadyDeclared(hookBlock, hookName) {
    if (!isUndefined(hookBlock)) {
      throw new Error(TestSuite.alreadyDefinedHookErrorMessage(hookName));
    }
  }

  #validateTheHookBlockIsAFunction(hookBlock, hookName) {
    if (!isFunction(hookBlock)) {
      throw new Error(TestSuite.hookWasNotInitializedWithAFunctionErrorMessage(hookName));
    }
  }

  // Private - Running

  #randomizeTests() {
    shuffle(this.tests());
  }

  #evaluateSuiteDefinition() {
    this.#body.call();
    this.#evaluateExclusiveRunsMarks();
  }

  #evaluateExclusiveRunsMarks() {
    if (this.#thereAreTestsMarkedAsExclusive()) {
      this.#skipTestsNotMarkedAsExclusive();
    }
  }

  #thereAreTestsMarkedAsExclusive() {
    return this.tests().some(test => test.isMarkedAsExclusiveForRun());
  }

  #skipTestsNotMarkedAsExclusive() {
    this.tests().forEach(test => {
      if (!test.isMarkedAsExclusiveForRun()) {
        test.skip();
      }
    });
  }

  async #runTests(context) {
    if (context.randomOrderMode) {
      this.#randomizeTests();
    }

    context.hooks = {
      [TestSuite.BEFORE_HOOK_NAME]: this.#before,
      [TestSuite.AFTER_HOOK_NAME]: this.#after,
    };

    // eslint-disable-next-line no-restricted-syntax
    for (const test of this.tests()) {
      // NOTE: test will run in sequence, by design. The tool is not (yet) supporting parallel execution.
      this.#currentTest = test;

      // eslint-disable-next-line no-await-in-loop
      await test.run(context);
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Oct 12 2025 19:17:29 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
